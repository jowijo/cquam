gr-cquam
=====

AM Stereo flowgraph for GNURadio. Implementation of Motorola's CQUAM standard for AM Stereo transmission in GNURadio. The flowgraph uses native blocks, and requires no extra dependancies.
##Included
* **[NEW] CQUAM.xml** -- Hierarchical block for GNURadio. A complete CQUAM transmitter in a single block.
* **CQUAM.GRC** -- The main attraction. A GRC (Gnuradio Companion) flowgraph of an AM Stereo transmitter per the C-QUAM standard.
* **mw.sts (optional)** -- Optimised preset for the Stereo Tool processor for use in the CQUAM transmitter. (See "Usage").
* **IQ Samples: cquam.wav, cquam_2.wav** -- A complex WAV file that can be played in SDR software (e.g SDR#, SoDiRa). Currently, only the SoDiRa software can decode C-QUAM. (See "Listening").

##Usage (cquam.grc)
The defaul configuration takes audio samples from a FIFO. An example of sending music to the transmitter is below:
```
mpg123 -s http://127.0.0.1:8000 | ./stc - - -s mw.sts > /tmp/play
```

..to test without mpd or another local source, simply subsitute the stream with any online feed (http://somafm.com/):
```
mpg123 -s http://maxxima.mine.nu:8000 | ./stc - - -s mw.sts > /tmp/play
```

* mpg123 plays my mpd stream.
* ./stc is my audio processor, Stereo Tool (http://www.stereotool.com/). This is optional.
* '/tmp/play' is the named pipe which will send the audio data to the transmitter.

In any case, most audio programs that run in a command-line should put out valid (PCM) samples; so long as they a piped through '/tmp/play'. Alternatively, you can replace the file block with an audio block for ALSA or JACK input, but bear in mind JACK does not support Stereo input, and ALSA is often slow and impairs performance. 

The signal generated by the graph is a baseband C-QUAM signal. Simply attaching the virtual device to the UHD or osmosdr block with proper parameters shold produce a proper signal for testing. This was tested on a BladeRF and worked. The WAV dump of the generated signal was tested in SoDiRa software, and played as intended.

##Listening
The signal should work on any AM Stereo/CQUAM reciever.

You can listen to the WAV files generated by the flowgraph in SDR programs, or even Audacity or a standard audio player. To decode C-QUAM however, one needs the non-free SoDiRa (has a demo version). The following steps are for listening to the AM Stereo signal in SoDiRa.

* Click "Play" on the bottom right set of buttons. Select the sample or dumped WAV using explorer.
* You should see some signal on the left of the FFT. To the far right of the "Play" button, there is a button labled "real r" (Or "I/Q" if no file is playing). Click it until it reads "IQ r/i". The baseband should now be centered in the FFT.
* Using the dropdown labled "Broadcast Radio", select "AM Radio".
* Now, click the "Debug Window" button above.
* In this new window, Select two things: Set the baseband bandwidth to "10khz", then change the "AM Type" to "Stereo (C-QUAM)". At this point, you should hear the stereo signal. 
* **OPTIONAL:** For hearing the entire 11khz signal, Set the baseband bandwidth to "Manuell" (Manual), and drag the "Width" scrollbar up until the FFT selection covers the baseband signal and some space around it.
